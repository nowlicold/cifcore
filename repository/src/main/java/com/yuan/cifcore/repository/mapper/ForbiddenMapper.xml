<?xml version="1.0" encoding="GB2312" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- ==========================================================  -->
<!-- Configuration for ibatis sqlmap mapping.                    -->
<!-- ==========================================================  -->

<!-- ============================================================================= -->
<!-- This file is generated by <tt>bench-gen-dal</tt>, a DAL (Data Access Layer)  -->
<!-- code generation utility specially developed for <tt>bench</tt> project.     -->
<!--                                                                               -->
<!-- PLEASE DO NOT MODIFY THIS FILE MANUALLY, or else your modification may be     -->
<!-- OVERWRITTEN by someone else. To modify the file, you should go to directory   -->
<!-- <tt>(project-home)/biz/dal/src/conf/dalgen</tt>, and find the corresponding   -->
<!-- configuration files. Modify those files according to your needs, then run     -->
<!-- <tt>bench-gen-dal</tt> to generate this file.                                -->
<!--                                                                               -->
<!-- @author nowli                                                          -->
<!-- ============================================================================= -->

<mapper namespace="com.yuan.cifcore.repository.mapper.ForbiddenMapper">
	
    <!-- ============================================= -->
    <!-- RESULT MAPS                                   -->
    <!-- ============================================= -->

    <!-- result maps for database table cif_forbidden -->
    <resultMap id="RM-FORBIDDEN" type="com.yuan.cifcore.repository.entity.ForbiddenDO">
        <result property="id" column="id"  javaType="java.lang.String"  jdbcType="VARCHAR"/>
        <result property="forbiddenObjectType" column="forbidden_object_type"  javaType="java.lang.String"  jdbcType="VARCHAR"/>
        <result property="forbiddenObjectId" column="forbidden_object_id"  javaType="java.lang.String"  jdbcType="VARCHAR"/>
        <result property="forbiddenReason" column="forbidden_reason"  javaType="java.lang.String"  jdbcType="LONGVARCHAR"/>
        <result property="enabled" column="enabled"  javaType="boolean"  jdbcType="DECIMAL"/>
        <result property="gmtStart" column="gmt_start"  javaType="java.util.Date"  jdbcType="TIMESTAMP"/>
        <result property="gmtEnd" column="gmt_end"  javaType="java.util.Date"  jdbcType="TIMESTAMP"/>
        <result property="gmtCreate" column="gmt_create"  javaType="java.util.Date"  jdbcType="TIMESTAMP"/>
        <result property="gmtModified" column="gmt_modified"  javaType="java.util.Date"  jdbcType="TIMESTAMP"/>
        <result property="forbiddenMinutes" column="forbidden_minutes"  javaType="long"  jdbcType="DECIMAL"/>
        <result property="memo" column="memo"  javaType="java.lang.String"  jdbcType="VARCHAR"/>
        <result property="forbiddenActionTypeId" column="forbidden_action_type_id"  javaType="long"  jdbcType="DECIMAL"/>
        <result property="operatorType" column="operator_type"  javaType="java.lang.String"  jdbcType="VARCHAR"/>
        <result property="operatorId" column="operator_id"  javaType="java.lang.String"  jdbcType="VARCHAR"/>
        <result property="status" column="status"  javaType="java.lang.String"  jdbcType="VARCHAR"/>
        <result property="bizUniqueId" column="biz_unique_id"  javaType="java.lang.String"  jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
         id  ,
         forbidden_object_type  ,
         forbidden_object_id  ,
         forbidden_reason  ,
         enabled  ,
         gmt_start  ,
         gmt_end  ,
         gmt_create  ,
         gmt_modified  ,
         forbidden_minutes  ,
         memo  ,
         forbidden_action_type_id  ,
         operator_type  ,
         operator_id  ,
         status  ,
         biz_unique_id 
    </sql>



   <sql id="SQL-CIF-FORBIDDEN-searchWhereSql">
	  <where>
				<if test="id != null and id != ''">
						and id=#id#
				</if>	
			 	<if test="forbiddenObjectId != null and forbiddenObjectId != ''">
						and forbidden_object_id=#forbiddenObjectId#
				</if>
				<if test="forbiddenObjectType != null and forbiddenObjectType != ''">
						and forbidden_object_type=#forbiddenObjectType#
				</if>		
				<if test="enabled != null">
                 		and enabled=#enabled#
                </if>
                <if test="forbiddenActionTypeId != null and forbiddenActionTypeId != ''">
						and forbidden_action_type_id=#forbiddenActionTypeId#
				</if>	
                <if test="minGmtEnd != null">
    			        and gmt_end &gt;= #minGmtEnd#
                 </if>
                 <if test="maxGmtEnd != null">
					    and gmt_end &lt;= #maxGmtEnd#
                 </if>
                <if test="userSubDomain != null and userSubDomain != ''">
						and exists (select 1 from cif_user a where a.user_id=forbidden_object_id and forbidden_object_type='USER' and a.sub_domain=#userSubDomain#)
				</if>             
			</where>
   </sql>

    <!-- ============================================= -->
    <!-- mapped statements for IbatisForbiddenDAO -->
    <!-- ============================================= -->
    <!-- mapped statement for IbatisForbiddenDAO.selectById -->
    <select id="selectById" resultMap="RM-FORBIDDEN">
    <![CDATA[
        select id, forbidden_object_type, forbidden_object_id, status, forbidden_reason, enabled, gmt_start, gmt_end, gmt_create, gmt_modified, forbidden_minutes, memo, forbidden_action_type_id, operator_type, operator_id, biz_unique_id from cif_forbidden where (id = #{id})
    ]]>
    </select>
    <!-- mapped statement for IbatisForbiddenDAO.selectByIdForUpdate -->
    <select id="selectByIdForUpdate" resultMap="RM-FORBIDDEN">
    <![CDATA[
        select id, forbidden_object_type, forbidden_object_id, status, forbidden_reason, enabled, gmt_start, gmt_end, gmt_create, gmt_modified, forbidden_minutes, memo, forbidden_action_type_id, operator_type, operator_id, biz_unique_id from cif_forbidden where (id = #{id}) for update 
    ]]>
    </select>
    <!-- mapped statement for IbatisForbiddenDAO.selectMaxGmtEndByForbiddenObjectIdsAndForbiddenObjectTypes -->
    <select id="selectMaxGmtEndByForbiddenObjectIdsAndForbiddenObjectTypes" resultMap="RM-FORBIDDEN">
        select * from  (select id, forbidden_object_type, forbidden_object_id, status,			forbidden_reason, enabled, gmt_start, gmt_end, gmt_create,			gmt_modified, forbidden_minutes, memo, forbidden_action_type_id,			operator_type, operator_id ,biz_unique_id from cif_forbidden  			where enabled=1 and gmt_end &gt;=sysdate                                     <if test="forbiddenObjectIds != null and forbiddenObjectIds.isEmpty()">							  and							   <foreach open="forbidden_object_id in (" close=")" separator="," collection="forbiddenObjectIds" item="item">									 	#{item}							   </foreach>                    </if>                    <if test="forbiddenObjectTypes != null and forbiddenObjectTypes.isEmpty()">							  and							   <foreach open="forbidden_object_type in (" close=")" separator="," collection="forbiddenObjectTypes" item="item">									 	#{item}							   </foreach>                    </if>           	   			order by gmt_end desc) where rownum=1
    </select>
    <!-- mapped statement for IbatisForbiddenDAO.selectMaxGmtEndByForbiddenObjectIdsAndForbiddenObjectTypesAndActionTypeId -->
    <select id="selectMaxGmtEndByForbiddenObjectIdsAndForbiddenObjectTypesAndActionTypeId" resultMap="RM-FORBIDDEN">
        select * from  (select id, forbidden_object_type, forbidden_object_id, status,			forbidden_reason, enabled, gmt_start, gmt_end, gmt_create,			gmt_modified, forbidden_minutes, memo, forbidden_action_type_id,			operator_type, operator_id ,biz_unique_id from cif_forbidden			where enabled=1 and gmt_end &gt;=sysdate                                    <if test="forbiddenObjectIds != null and forbiddenObjectIds.isEmpty()">							  and							   <foreach open="forbidden_object_id in (" close=")" separator="," collection="forbiddenObjectIds" item="item">									 	#{item}							   </foreach>                    </if>                    <if test="forbiddenObjectTypes != null and forbiddenObjectTypes.isEmpty()">							  and							   <foreach open="forbidden_object_type in (" close=")" separator="," collection="forbiddenObjectTypes" item="item">									 	#{item}							   </foreach>                    </if>                    <if test="forbiddenActionTypeId == 0">						and forbidden_action_type_id=#{forbiddenActionTypeId}					</if>           	   			order by gmt_end desc) where rownum=1
    </select>
    <!-- mapped statement for IbatisForbiddenDAO.selectCountByForbiddenObjectIdsAndForbiddenObjectTypes -->
    <select id="selectCountByForbiddenObjectIdsAndForbiddenObjectTypes" resultType="long">
        select count(*) from cif_forbidden where status=#{status}					<if test="forbiddenObjectIds != null and forbiddenObjectIds.isEmpty()">							  and							   <foreach open="forbidden_object_id in (" close=")" separator="," collection="forbiddenObjectIds" item="item">									 	#{item}							   </foreach>                    </if>                    <if test="forbiddenObjectTypes != null and forbiddenObjectTypes.isEmpty()">							  and							   <foreach open="forbidden_object_type in (" close=")" separator="," collection="forbiddenObjectTypes" item="item">									 	#{item}							   </foreach>                    </if>
    </select>
    <!-- mapped statement for IbatisForbiddenDAO.selectByBizUniqueId -->
    <select id="selectByBizUniqueId" resultMap="RM-FORBIDDEN">
    <![CDATA[
        select id, forbidden_object_type, forbidden_object_id, status, forbidden_reason, enabled, gmt_start, gmt_end, gmt_create, gmt_modified, forbidden_minutes, memo, forbidden_action_type_id, operator_type, operator_id, biz_unique_id from cif_forbidden where (biz_unique_id = #{bizUniqueId})
    ]]>
    </select>
    <!-- mapped statement for IbatisForbiddenDAO.selectByStatusGmtEndAndEnabled -->
    <select id="selectByStatusGmtEndAndEnabled" resultMap="RM-FORBIDDEN">
        select * from(   			select id, forbidden_object_type, forbidden_object_id, status,			forbidden_reason, enabled, gmt_start, gmt_end, gmt_create,			gmt_modified, forbidden_minutes, memo, forbidden_action_type_id,			operator_type, operator_id ,biz_unique_id from cif_forbidden where			status = #{status} and gmt_end &lt;= sysdate and enabled=1			order by gmt_end )			where rownum &lt; #{count}
    </select>
    <!-- mapped statement for IbatisForbiddenDAO.updateEnabledById -->
    <update id="updateEnabledById">
    <![CDATA[
        update cif_forbidden set enabled=#{enabled}, gmt_modified=sysdate() where (id = #{id})
    ]]>
    </update>

    <!-- mapped statement for IbatisForbiddenDAO.updateStatusAndBizUniqueIdById -->
    <update id="updateStatusAndBizUniqueIdById">
    <![CDATA[
        update cif_forbidden set status=#{status}, biz_unique_id=#{bizUniqueId}, gmt_modified=sysdate() where (id = #{id})
    ]]>
    </update>

    <!-- mapped statement for IbatisForbiddenDAO.updateStatusAndBizUniqueIdAndEnabledById -->
    <update id="updateStatusAndBizUniqueIdAndEnabledById">
    <![CDATA[
        update cif_forbidden set status=#{status}, biz_unique_id=#{bizUniqueId}, enabled=#{enabled}, gmt_modified=sysdate() where (id = #{id})
    ]]>
    </update>

    <!-- mapped statement for IbatisForbiddenDAO.updateForbiddenInfoById -->
    <update id="updateForbiddenInfoById">
    <![CDATA[
        update cif_forbidden set status=#{status}, forbidden_reason=#{forbiddenReason}, gmt_start=#{gmtStart}, gmt_end=#{gmtEnd}, gmt_modified=sysdate, forbidden_minutes=#{forbiddenMinutes}, memo=#{memo}, operator_type=#{operatorType}, forbidden_action_type_id=#{forbiddenActionTypeId}, operator_id=#{operatorId}, biz_unique_id=#{bizUniqueId} where (id = #{id})
    ]]>
    </update>

    <!-- mapped statement for IbatisForbiddenDAO.search -->
    <!-- queryPage分页方法dba注意sqlreview -->
    <select id="search" resultMap="RM-FORBIDDEN">
        select id, forbidden_object_type, forbidden_object_id, status,			forbidden_reason, enabled, gmt_start, gmt_end, gmt_create,			gmt_modified, forbidden_minutes, memo, forbidden_action_type_id,			operator_type, operator_id ,biz_unique_id from cif_forbidden			<include refid="SQL-CIF-FORBIDDEN-searchWhereSql"/>			order by gmt_create desc,gmt_end desc,id desc
    </select>
 

</mapper>